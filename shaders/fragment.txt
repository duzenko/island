#version 130 

uniform sampler2D texture, shadow;

in vec4 fpos, spos;
in vec2 ftex;

out vec3 color;

void main(){
  vec3 sposb = vec3(spos.xyz*0.5+vec3(0.5, 0.5, 0.5));
  float shadowZ = texture2D(shadow, sposb.xy).z;
  color = texture2D(texture, ftex).rgb;
//  color = sposb.xyz;
//  color = vec3(0, 0, shadowZ);
  if (shadowZ < sposb.z - 1e-3)
    color = color*0.5;
}
