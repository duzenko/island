#version 130

uniform sampler2D material;
uniform sampler2DShadow shadow;
uniform vec3 sunPos;
uniform float lightOverride;

in vec4 spos;
in vec3 fnorm;
in vec2 ftex;

out vec3 color;


void main(){
  if (lightOverride == 1)
    color = texture(material, ftex).rgb;
  else {
    float ambient = sunPos.z*0.5;
    vec3 sposb = vec3(spos.xyz*0.5+vec3(0.5, 0.5, 0.5));
    float shadowZ = texture(shadow, sposb);
    float brightness = dot(fnorm, sunPos);
    if (brightness < 0)
      brightness = ambient;
    else
      brightness = brightness * shadowZ + ambient;
    color = texture(material, ftex).rgb * brightness;
  }
//  color = (fnorm);
}
