#version 130 

uniform sampler2D texture, shadow;

in vec4 fpos, spos;
in vec2 ftex;

out vec3 color;

void main(){
  vec3 sposb = vec3(spos.xyz*0.5+vec3(0.5, 0.5, 0.5));
  float shadowZ = texture2D(shadow, sposb.xy).z;
  color = texture2D(texture, ftex).rgb;
//  color = sposb.xyz;
//  color = vec3(0, 0, shadowZ);
  if (sposb.z > shadowZ)
    if (sposb.z - shadowZ < 1e-2)
      color = color*(1-(sposb.z - shadowZ)/2e-2);
    else
      color = color*0.5;
}
